<div class="interactive-container">
    <div class="building-explorer">
        <div class="header-controls">
            <h1>{{ proyecto.nombre }}</h1>
            <div class="bloque-switcher">
                <button [class.active]="bloqueActivo === 'A'" (click)="bloqueActivo = 'A'">BLOQUE A</button>
                <button [class.active]="bloqueActivo === 'B'" (click)="bloqueActivo = 'B'">BLOQUE B</button>
            </div>
        </div>

        <div class="building-grid">
            <div *ngFor="let nivel of proyecto.niveles" class="floor-row">
                <div class="floor-label">{{ nivel.etiqueta }}</div>

                <div class="units-container">
                    <ng-container *ngIf="nivel.tipo_nivel === 'compartido'">
                        <div *ngFor="let u of nivel.bloques[0].unidades" class="unit-item shared-unit"
                            [ngClass]="u.estado" (click)="seleccionarUnidad(u,nivel.etiqueta)">
                            {{ u.nombre }} <span *ngIf="u.dormitorios !== 0"> - {{ u.dormitorios }}</span>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="nivel.tipo_nivel === 'dividido'">
                        <div *ngFor="let bloque of nivel.bloques">
                            <div class="units-sub-grid" *ngIf="bloque.nombre === bloqueActivo">
                                <div *ngFor="let u of bloque.unidades" class="unit-item" [ngClass]="u.estado"
                                    (click)="seleccionarUnidad(u,nivel.etiqueta)">
                                    <span class="unit-name">{{ u.nombre }}</span> <span *ngIf="u.dormitorios !== 0"> {{
                                        u.dormitorios }} Dormitorio<span *ngIf="u.dormitorios > 1">s</span></span>
                                    <span class="unit-price" *ngIf="u.precio">${{ u.precio | number }}</span>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>

    <div class="project-sidebar">
        <div class="project-info-card">
            <h3>Informaci√≥n adicional</h3>

            <div class="info-item">
                <div class="info-icon">üìç</div>
                <div class="info-text">
                    <strong>Direcci√≥n</strong>
                    <p>{{ proyecto.direccion_general }}</p>
                </div>
            </div>

            <div class="map-container">
                <iframe [src]="mapaUrl" width="100%" height="200" style="border:0;" allowfullscreen="" loading="lazy">
                </iframe>
                <a [href]="'https://www.google.com/maps/search/?api=1&query=' + proyecto.ubicacion_gps.lat + ',' + proyecto.ubicacion_gps.lng"
                    target="_blank" class="map-link">
                    Abrir en Google Maps ‚Üó
                </a>
            </div>

            <div class="info-item">
                <div class="info-icon">üêæ</div>
                <div class="info-text">
                    <strong>Pol√≠tica de Mascotas</strong>
                    <p [ngClass]="{'text-success': admiteMascotas, 'text-danger': !admiteMascotas}">
                        {{ admiteMascotas ? 'Permitidas (M√°ximo ' + proyecto.politicas_globales.max_mascotas + ')' : 'No se aceptan mascotas' }}
                    </p>
                </div>
            </div>

            <!-- <div class="project-notes">
                <small>* Los precios y disponibilidad pueden variar sin previo aviso.</small>
            </div> -->
        </div>
    </div>

    <app-modal-unidad *ngIf="unidadSeleccionada" [unidad]="unidadSeleccionada" [nombreProyecto]="proyecto.nombre"
        [bloque]="bloqueActivo" [piso]="pisoSeleccionado" (close)="cerrarDetalle()">
    </app-modal-unidad>
</div>